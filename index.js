#!/usr/bin/env node
// -*- coding: utf-8 -*-
'use strict';if(typeof module!=='undefined'&&module!==null&&eval('typeof require')!=='undefined'&&eval('require')!==null&&'main'in eval('require')&&eval('typeof require.main')!=='undefined'&&eval('require.main')!==null){var ORIGINAL_MAIN_MODULE=module;if(module!==eval('require.main')&&'paths'in module&&'paths'in eval('require.main')&&typeof __dirname!=='undefined'&&__dirname!==null)module.paths=eval('require.main.paths').concat(module.paths.filter(function(path){return eval('require.main.paths').includes(path)}))};if(module===eval('require.main'))module.paths.unshift('/application/node_modules');(()=>{"use strict";var __webpack_modules__=[(module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>__WEBPACK_DEFAULT_EXPORT__});var _babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(1),_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_0__),_babel_runtime_helpers_extends__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(2),_babel_runtime_helpers_extends__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(_babel_runtime_helpers_extends__WEBPACK_IMPORTED_MODULE_1__),_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(3),_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_2___default=__webpack_require__.n(_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_2__),clientnode__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(4),clientnode__WEBPACK_IMPORTED_MODULE_3___default=__webpack_require__.n(clientnode__WEBPACK_IMPORTED_MODULE_3__),http__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(5),http__WEBPACK_IMPORTED_MODULE_4___default=__webpack_require__.n(http__WEBPACK_IMPORTED_MODULE_4__),http2__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(6),http2__WEBPACK_IMPORTED_MODULE_5___default=__webpack_require__.n(http2__WEBPACK_IMPORTED_MODULE_5__),net__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(7),net__WEBPACK_IMPORTED_MODULE_6___default=__webpack_require__.n(net__WEBPACK_IMPORTED_MODULE_6__),path__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(8),path__WEBPACK_IMPORTED_MODULE_7___default=__webpack_require__.n(path__WEBPACK_IMPORTED_MODULE_7__),tls__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(9),tls__WEBPACK_IMPORTED_MODULE_8___default=__webpack_require__.n(tls__WEBPACK_IMPORTED_MODULE_8__),_package_json__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__(10);function _createForOfIteratorHelperLoose(e,_){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(r)return(r=r.call(e)).next.bind(r);if(Array.isArray(e)||(r=_unsupportedIterableToArray(e))||_&&e&&"number"==typeof e.length){r&&(e=r);var t=0;return function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,_){if(e){if("string"==typeof e)return _arrayLikeToArray(e,_);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray(e,_):void 0}}function _arrayLikeToArray(e,_){(null==_||_>e.length)&&(_=e.length);for(var r=0,t=Array(_);r<_;r++)t[r]=e[r];return t}module=__webpack_require__.hmd(module);var CONFIGURATION=_package_json__WEBPACK_IMPORTED_MODULE_9__.DN,configurationPath=(0,path__WEBPACK_IMPORTED_MODULE_7__.resolve)(process.cwd(),"configuration.json");clientnode__WEBPACK_IMPORTED_MODULE_3___default().isFileSync(configurationPath)&&clientnode__WEBPACK_IMPORTED_MODULE_3___default().extend(!0,CONFIGURATION,clientnode__WEBPACK_IMPORTED_MODULE_3___default().evaluateDynamicData(eval("require('"+configurationPath+"')"),{configuration:CONFIGURATION,environment:process.env,Tools:clientnode__WEBPACK_IMPORTED_MODULE_3___default()}));var createConnection=CONFIGURATION.forward.tls?tls__WEBPACK_IMPORTED_MODULE_8__.connect:net__WEBPACK_IMPORTED_MODULE_6__.createConnection,portSuffix=CONFIGURATION.forward.tls&&443!==CONFIGURATION.forward.port||!CONFIGURATION.forward.tls&&80!==CONFIGURATION.forward.port?":"+CONFIGURATION.forward.port:"",reverseProxyBufferedRequest=function(e,_){var r=createConnection(_babel_runtime_helpers_extends__WEBPACK_IMPORTED_MODULE_1___default()({host:CONFIGURATION.forward.host,port:CONFIGURATION.forward.port},CONFIGURATION.forward.tls?{servername:CONFIGURATION.forward.host,rejectUnauthorized:!1}:{}),(function(){console.info("Proxy to: http"+(CONFIGURATION.forward.tls?"s":"")+"://"+CONFIGURATION.forward.host+portSuffix)}));if(r.on("error",(function(e){console.error("Proxy to server error",e)})),CONFIGURATION.forward.headerTransformation.retrieve.length){var t=!1;r.on("data",(function(_){if(t)e.write(_);else{for(var r,o,a=_.toString(),n=_createForOfIteratorHelperLoose(CONFIGURATION.forward.headerTransformation.retrieve);!(r=n()).done;)o=r.value,a=a.replace(o.source,o.target);e.write(a),t=!0}}))}else r.pipe(e);r.on("connect",(function(){for(var e,t,o=!1,a=_createForOfIteratorHelperLoose(_);!(e=a()).done;)if(t=e.value,o)r.write(t);else{var n=t.toString();CONFIGURATION.forward.tls&&(n=n.replace(/HTTP\/1\.0/i,"HTTP/1.1")),n=n.replace(/(($|\n)host: )[^\n]+/i,"$1"+CONFIGURATION.forward.host+portSuffix);for(var s,i,c=_createForOfIteratorHelperLoose(CONFIGURATION.forward.headerTransformation.send);!(s=c()).done;)i=s.value,n=n.replace(i.source,i.target);console.info("Send:\n\n"+n),r.write(n),o=!0}}))},onIncomingMessage=function(e,_){_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_0___default()(_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_2___default().mark((function r(){return _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_2___default().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(!e.headers.response){r.next=4;break}return _.write(e.headers.response),_.end(),r.abrupt("return");case 4:return r.next=6,clientnode__WEBPACK_IMPORTED_MODULE_3___default().timeout();case 6:reverseProxyBufferedRequest(_.socket,e.socket.buffers);case 7:case"end":return r.stop()}}),r)})))()},onIncomingStream=function(e,_){console.info("Got stream",e,_)},server={instance:CONFIGURATION.publicKeyPath&&CONFIGURATION.privateKeyPath?(0,http2__WEBPACK_IMPORTED_MODULE_5__.createSecureServer)(CONFIGURATION.nodeServerOptions,onIncomingMessage):(0,http__WEBPACK_IMPORTED_MODULE_4__.createServer)(onIncomingMessage),streams:[],sockets:[],start:function(){server.instance.listen(CONFIGURATION.port,CONFIGURATION.host,(function(){return console.info("Server started.")}))},stop:function(){server.instance.close((function(){console.info("Shut server down.")}));for(var e,_=0,r=[server.sockets,server.streams];_<r.length;_++)if(e=r[_],Array.isArray(e))for(var t,o=_createForOfIteratorHelperLoose(e);!(t=o()).done;)t.value.destroy()}};server.instance.on("connection",(function(e){var _=[];e.on("data",(function(e){_.push(e)})),e.buffers=_,server.sockets.push(e),e.on("close",(function(){server.sockets.splice(server.sockets.indexOf(e),1)}))})),server.instance.on("stream",(function(e,_){server.streams.push(e),onIncomingStream(e,_),e.on("close",(function(){server.streams.splice(server.streams.indexOf(e),1)}))})),(__webpack_require__.c[__webpack_require__.s]===module||eval("require.main")!==__webpack_require__.c[__webpack_require__.s])&&(console.info("Start server with configuration:",CONFIGURATION),server.start());const __WEBPACK_DEFAULT_EXPORT__=server},e=>{e.exports=require("@babel/runtime/helpers/asyncToGenerator")},e=>{e.exports=require("@babel/runtime/helpers/extends")},e=>{e.exports=require("@babel/runtime/regenerator")},e=>{e.exports=require("clientnode")},e=>{e.exports=require("http")},e=>{e.exports=require("http2")},e=>{e.exports=require("net")},e=>{e.exports=require("path")},e=>{e.exports=require("tls")},e=>{e.exports=JSON.parse('{"DN":{"publicKeyPath":"","privateKeyPath":"","nodeServerOptions":{"allowHTTP1":true},"host":"localhost","port":8080,"forward":{"headerTransformation":{"retrieve":[],"send":[]},"host":"localhost","port":443,"tls":true},"humanChecker":{"applicationInterfaces":{"base":{"key":"","url":""}},"identifiyAsHumanIfServiceThrowsException":true,"skipSecrets":[]}}}')}],__webpack_module_cache__={};function __webpack_require__(e){var _=__webpack_module_cache__[e];if(void 0!==_)return _.exports;var r=__webpack_module_cache__[e]={id:e,loaded:!1,exports:{}};return __webpack_modules__[e](r,r.exports,__webpack_require__),r.loaded=!0,r.exports}__webpack_require__.c=__webpack_module_cache__,__webpack_require__.n=e=>{var _=e&&e.__esModule?()=>e.default:()=>e;return __webpack_require__.d(_,{a:_}),_},__webpack_require__.d=(e,_)=>{for(var r in _)__webpack_require__.o(_,r)&&!__webpack_require__.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:_[r]})},__webpack_require__.hmd=e=>((e=Object.create(e)).children||(e.children=[]),Object.defineProperty(e,"exports",{enumerable:!0,set:()=>{throw new Error("ES Modules may not assign module.exports or exports.*, Use ESM export syntax, instead: "+e.id)}}),e),__webpack_require__.o=(e,_)=>Object.prototype.hasOwnProperty.call(e,_),__webpack_require__.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var __webpack_exports__=__webpack_require__(__webpack_require__.s=0);module.exports=__webpack_exports__})();